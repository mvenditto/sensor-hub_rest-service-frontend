<html>
  <head>
    <!--<link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">-->
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="css/onsen-css-components.min.css">
    <link rel="stylesheet" href="css/vis-network.min.css"/>
    <!--<link rel="stylesheet" href="css/stylesheet.css">-->
    <link rel="stylesheet" href="css/json.css">
    <link rel="stylesheet" href="css/jquery.enhsplitter.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/web-animations.min.js"></script>
    <script src="js/hammer.min.js"></script>
    <script src="js/muuri.min.js"></script>
    <script src="js/vis.js"></script>
    <script src="js/index.js"></script>
    <script src="js/sh-graph.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/jquery.enhsplitter.js"></script>
    <script src="js/smoothie.js"></script>
    <script src="js/interact.min.js"></script>
    <script type="text/javascript" src="js/renderjson.js"></script>
    <style>
        #mynetwork {
            border: 1px solid darkgray;
            background-color: #d3d3d3;
            overflow: hidden;
        }

        #netexplorer {
          height: 99%;
        }

        .toast--success__message {
          color: lightgreen;
        }

        .toast--failure__message {
          color: red;
        }

        a#task-result {
          color: #bdc7be;
        }

        ons-input .text-input__container input {
          width: 100%;
          display: inline-block;
        }

        .grid {
          position: relative;
          border: 5px solid transparent;
        }
        .item {
          display: inline-block;
          position: absolute;
          //width: 500px;
          //height: 150px;
          min-width:300px;
          min-height:100px;
          z-index: 1;
          box-sizing: border-box;
          background-color: #dddddd;
          margin:20px;
          padding: 4px 4px 6px;
        }
        .item.muuri-item-hidden {
          z-index: 0;
        }
        .item.muuri-item-releasing {
          z-index: 2;
        }
        .item.muuri-item-dragging {
          z-index: 3;
        }
        .item-content {
          position: relative;
          text-align: center;
          background: #dddddd;
          color: white;
          border: 1px solid #bcbcbc;
          //padding: 2%;
        }

        .item.muuri-item-dragging .item-content,
        .item.muuri-item-releasing .item-content {
          background: blue;
        }

        .item-item {
          position: relative;
          display: block;
          box-sizing: border-box;
        }

        div.smoothie-chart-tooltip {
          background: #444;
          padding: 1em;
          margin-top: 20px;
          font-family: consolas;
          color: white;
          font-size: 10px;
          pointer-events: none;
        }

        ons-select {
          padding-right: 20px;
          padding-left: 20px;
          padding-top: 4px;
          border: 1px solid #bcbcbc;
        }

        canvas {
          //position: relative;
          //display: block;
          width: 100%;
          height: 100%;
        }

    ::-webkit-scrollbar-button{
        display: none;
        height: 13px;
        border-radius: 0px;
        background-color: #AAA;
    }
    ::-webkit-scrollbar-button:hover{
        background-color: #2c3a47;
    }
    ::-webkit-scrollbar-thumb{
        background-color: #606f7c;
    }
    ::-webkit-scrollbar-thumb:hover{
        background-color: #91a5b6;
    }
    ::-webkit-scrollbar-track{
        background-color: #2c3a47;
    }
    ::-webkit-scrollbar-track:hover{
        background-color: #2c3a47;
    }
    ::-webkit-scrollbar{
        width: 13px;
    }

    pre {
      padding: 20px;
      overflow: auto;
      color: #716a6a;
      text-shadow: none;
    	background-color: #2c3a47;
      border: 1px solid #0d0d0d;
    }
    pre code {
      padding: 0;
      color: #767474;
      background-color: #efeff4;
      border: none;
    }
    pre a {
      color: #FEA47F;
    }

    </style>
  </head>



  <ons-splitter>
    <ons-splitter-side id="menu" side="left" width="220px" collapse>
      <ons-page>
        <ons-list>
          <ons-list-item onclick="fn.loadPage('home.html')" tappable>
            Home
          </ons-list-item>
          <ons-list-item onclick="fn.loadPage('dashboard.html')" tappable>
            DashBoard
          </ons-list-item>
        </ons-list>
      </ons-page>
    </ons-splitter-side>
    <!--<ons-splitter-content id="content" page="home.html"></ons-splitter-content>-->
    <ons-navigator id="content" page="home.html"></ons-navigator>
  </ons-splitter>

  <template id="dashboard.html">
    <ons-page>
      <ons-toolbar>
        <div class="left">
          <ons-toolbar-button onclick="fn.open()">
            <ons-icon icon="md-menu"></ons-icon>
          </ons-toolbar-button>
        </div>
        <div class="center">
          Sensors-Hub DashBoard
        </div>
      </ons-toolbar>
      <div id="dash">
        <ons-row>
          <ons-col>
            <ons-select style="width:100%;margin: 4px" id="choose-sel" onchange="editSelects(event)">
            </ons-select>
          </ons-col>
          <ons-col>
            <ons-button style="margin-top: 3px; margin-left:50px;" onclick="createItem(select_ds)">
              <ons-icon icon="md-plus" ></ons-icon>
            </ons-button>
            <ons-button style="margin-top: 3px;" onclick="createAllItems()">
              <ons-icon icon="md-chart"></ons-icon>
            </ons-button>
          </ons-col>
        </ons-row>
        <div>
          <!---
          <ons-card>
            <div class="title" style="color: #CAD3C8; border-bottom: 1px solid #CAD3C8;">Graph</div>
            <div id="graphContainer" class="content"></div>
          </ons-card>-->
        </div>
        <div class="grid"></div>
      </div>
      <script type="text/javascript">
        var grid1 = new Muuri('.grid', {
          layout: {
            fillGaps: false,
            horizontal: false,
            alignRight: false,
            alignBottom: false,
            rounding: false
          },
          removeElements: true,
          dragEnabled: true,
          dragContainer: null,//document.getElementById("dash"),
          dragStartPredicate: function(item, event) {
            let bbox = item._element.getBoundingClientRect()
            let c = event.center
            let canDrag = (c.x >= bbox.x + 30
            && c.y >= bbox.y + 30
            && c.x <= (bbox.width + bbox.x - 30)
            && c.y <= (bbox.height + bbox.y - 30))
            return canDrag

          },
          dragSort: function () {
            return [grid1]
          }
        })
        .on('dragInit', function (item, event) { });

        //$("div.grid.muuri").css({height:"100%"})

        makeItemsResizable()

        ons.getScriptPage().onInit = function() {
          shGet(DATASTREAMS).then(dss => {
            let dss_ = JSON.parse(dss)
            dss_.forEach(ds => addOption(ds.sensor.id + "_" + ds.name))
            if (dss_.length > 0) {
              let ds = dss_[0]
              select_ds = ds.sensor.id + "_" + ds.name
            }
          })

          this.onShow = function() {   console.log("onShow") };
          this.onHide = function() {   console.log("onHide") };
          this.onDestroy = function() {   console.log("onDestroy") };
        };



      </script>
    </ons-page>
  </template>

  <template id="home.html">
    <ons-page>
      <ons-toolbar>
        <div class="left">
          <ons-toolbar-button onclick="fn.open()">
            <ons-icon icon="md-menu"></ons-icon>
          </ons-toolbar-button>
        </div>
        <div class="right">
          <ons-toolbar-button onclick="toggleGraphMenu()">
            <ons-icon id="toggle-graph-menu" icon="md-chevron-up"></ons-icon>
          </ons-toolbar-button>
        </div>
        <div class="center">
          Sensors-Hub Node Network
        </div>
      </ons-toolbar>
      <div id="root-container">
        <div id="netexplorer"></div>
        <div id="mynetwork"></div>
      </div>
      <script type="text/javascript">

        ons.getScriptPage().onInit = function() {

          renderjson.set_show_to_level(1);
          $('#root-container').enhsplitter({position: '30%'});
          $(document).ready(r => shBuildSystemGraph())

          this.onShow = function() {   console.log("onShow") };
          this.onHide = function() {   console.log("onHide") };
          this.onDestroy = function() {   console.log("onDestroy") };
        };

      </script>
    </ons-page>
  </template>

  <template id="dialog.html">
    <ons-alert-dialog id="my-dialog" modifier="rowfooter">
      <div class="alert-dialog-title">Alert</div>
      <div class="alert-dialog-content">
       Are you sure?
      </div>
      <div class="alert-dialog-footer">
        <ons-alert-dialog-button onclick="deleteDevice();hideDialog('my-dialog');">Ok</ons-alert-dialog-button>
        <ons-alert-dialog-button onclick="hideDialog('my-dialog')">Cancel</ons-alert-dialog-button>
      </div>
    </ons-alert-dialog>
  </template>

  <ons-modal id="loading-modal" direction="up">
    <div style="text-align: center">
      <p>
        <ons-icon icon="fa-spinner" size="28px" spin></ons-icon> Loading...
      </p>
    </div>
  </ons-modal>
</html>
